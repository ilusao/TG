<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Produto</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="cadastro_produto.css" rel="stylesheet">
</head>
<body>
    
    <header class="bg-custom text-center text-dark py-3 mb-4">
        <h2>CADASTRAR PRODUTO</h2>
    </header>

    <div class="dropdown position-absolute top-0 end-0 m-3">
        <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
            Opções
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <li><a class="dropdown-item" href="#">Menu</a></li>
            <li><a class="dropdown-item" href="#">Estoque</a></li>
            <li><a class="dropdown-item" href="#">Fornecedor</a></li>
            <li><a class="dropdown-item" href="#">Contato</a></li>
            <li><a class="dropdown-item" href="#">Cadastrar Produto</a></li>
            <li><a class="dropdown-item" href="#">Cadastrar Fornecedor</a></li>
            <li><a class="dropdown-item" href="#">Localizar Produto</a></li>
        </ul>
    </div>

    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <form id="productForm" novalidate>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="nome" class="form-label">Nome
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Nome do Produto" data-bs-content="Informe o nome completo do produto para identificação."></i>
                            </label>
                            <input type="text" class="form-control" id="nome" placeholder="Nome do Produto" required>
                        </div>
                        <div class="col-md-6">
                            <label for="descricao" class="form-label">Descrição PDV
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Descrição PDV" data-bs-content="Insira uma breve descrição do produto para o ponto de venda."></i>
                            </label>
                            <input type="text" class="form-control" id="descricao" placeholder="Descrição PDV" required>
                    
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="groupSelect" class="form-label">Grupo
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Grupo do Produto" data-bs-content="Selecione ou crie o grupo ao qual o produto pertence."></i>
                            </label>
                            <div class="input-group">
                                <select id="groupSelect" class="form-select custom-select"></select>
                                <button type="button" id="addGroup" class="btn btn-outline-secondary">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="subgroupSelect" class="form-label">Sub-Grupo
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Sub-Grupo do Produto" data-bs-content="Selecione ou crie o sub-grupo ao qual o produto pertence. Nota: só será possível selecionar o sub-grupo após a definição do grupo."></i>
                            </label>
                            <div class="input-group">
                                <select id="subgroupSelect" class="form-select custom-select"></select>
                                <button type="button" id="addSubgroup" class="btn btn-outline-secondary">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="fornecedor" class="form-label">Código do Fornecedor
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Código do Fornecedor" data-bs-content="Informe o código do fornecedor. Caso o fornecedor ainda não esteja cadastrado, será necessário registrá-lo posteriormente."></i>
                            </label>
                            <input type="text" class="form-control" id="fornecedor" required>
                          
                        </div>
                        <div class="col-md-6">
                            <label for="marca" class="form-label">Marca
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Marca do Produto" data-bs-content="Informe a marca do produto. Se preferir, pode usar o nome da empresa responsável pela fabricação."></i>
                            </label>
                            <input type="text" class="form-control" id="marca" required>
                          
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="codigoProduto" class="form-label">Código do Produto
                            <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Código do Produto" data-bs-content="Informe o código do produto, geralmente encontrado na embalagem. Se não houver, consulte o fornecedor ou seu superior."></i>
                            </label>
                            <input type="text" class="form-control" id="codigoProduto" required>
                       
                        </div>
                        <div class="col-md-6">
                            <label for="localizacao" class="form-label">Localização
                            <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Localização do Produto" data-bs-content="Informe a localização do produto, caso ele não esteja na empresa. Caso contrário, deixe em branco."></i>
                            </label>
                            <input type="text" class="form-control" id="localizacao" placeholder="Se o produto já esta na empresa, não coloque nada">
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="destino" class="form-label">Destino
                            <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Destino do Produto" data-bs-content="Informe o destino do produto, se ele ainda será enviado. Caso o produto já esteja no destino, deixe em branco."></i>
                            </label>
                            <input type="text" class="form-control" id="destino">
                     
                        </div>
                        <div class="col-md-6">
                            <label for="almoxerifado" class="form-label">Almoxerifado
                            <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Almoxarifado" data-bs-content="Indique o almoxarifado e a prateleira onde o produto está ou será armazenado. Caso o produto não esteja na empresa, deixe em branco."></i>
                            </label>
                            <input type="text" class="form-control" id="almoxerifado" required>
                   
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="dataEntrada" class="form-label">Data que o produto entrou ou vai entrar
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Data de Entrada" data-bs-content="Informe a data em que o produto entrou ou entrará na empresa. Não insira a data de cadastro."></i>
                            </label>
                            <input type="date" class="form-control" id="dataEntrada" required>
                        
                        </div>
                        <div class="col-md-6">
                            <label for="dataSaida" class="form-label">Data Saída
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Data de Saída" data-bs-content="Informe a data em que o produto sairá do almoxarifado. Se não souber a data exata, consulte o responsável ou deixe em branco."></i>
                            </label>
                            <input type="date" class="form-control" id="dataSaida">
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="preco" class="form-label">Preço
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Data de Saída" data-bs-content="Preço do produto"></i>
                            </label>
                            <input type="text" class="form-control" id="preco" required pattern="^\d{1,3}(?:[.,]\d{3})*(?:[.,]\d{2})$">
                            <div class="invalid-feedback">Por favor, insira o preço no formato correto (0.50 ou 1,000.50).</div>
                        </div>
                        <div class="col-md-6">
                            <label for="inflamavel" class="form-label">Inflamável
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Data de Saída" data-bs-content="Se o produto entra em combustão facil, isso vai facilita a entraga do produto"></i>
                            </label><br>
                            <select id="inflamavel" class="form-select">
                                <option value="nao">Não</option>
                                <option value="sim">Sim</option>
                            </select>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="fragil" class="form-label">Frágil
                                <i class="bi bi-question-circle" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" title="Data de Saída" data-bs-content="Se o produto quebra facil, isso vai facilitar a entrega do produto"></i>
                            </label><br>
                            <select id="fragil" class="form-select">
                                <option value="nao">Não</option>
                                <option value="sim">Sim</option>
                            </select>
                        </div>
                    </div>

                    <div class="d-flex justify-content-center mt-4">
                        <button id="Consult" type="submit" class="btn btn-dark">Registrar</button>
                    </div>
                    <p class="text-center mt-3">Cadastro referente apenas a produtos.</p>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Este caminho só funciona corretamente quando o servidor está em execução -->
     <!--Motivo: ele esta em outra pasta e o VS tenta pegar nessa pasta que da erro, mas o servidor (express) já tem as pasta o que no site não da erro...-->
    <script src="/cadastro_produto.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
            const popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
                return new bootstrap.Popover(popoverTriggerEl);
            });
        });
    </script>
    <script>
        document.getElementById('Consult').addEventListener('click', async (event) => {
            event.preventDefault(); // Evita o comportamento padrão do formulário
    
            // Capturar dados do formulário
            const dados = {
                nome: document.getElementById('nome').value,
                descricao: document.getElementById('descricao').value,
                grupo: document.getElementById('groupSelect').value,
                subgrupo: document.getElementById('subgroupSelect').value,
                fornecedor: document.getElementById('fornecedor').value,
                marca: document.getElementById('marca').value,
                codigoProduto: document.getElementById('codigoProduto').value,
                localizacao: document.getElementById('localizacao').value,
                destino: document.getElementById('destino').value,
                almoxerifado: document.getElementById('almoxerifado').value,
                dataEntrada: document.getElementById('dataEntrada').value,
                dataSaida: document.getElementById('dataSaida').value,
                preco: document.getElementById('preco').value,
                inflamavel: document.getElementById('inflamavel').value,
                fragil: document.getElementById('fragil').value
            };
    
            // Enviar dados ao backend
            try {
                const resposta = await fetch('http://127.0.0.1:3000/registrar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dados)
                });
    
                const resultado = await resposta.json();
    
                // Exibir mensagem de sucesso ou erro
                alert(resultado.mensagem);
            } catch (erro) {
                console.error('Erro ao registrar produto:', erro);
                alert('Ocorreu um erro ao registrar o produto.');
            }
        });
    </script>    

</body>
</html>